package com.example.sloppyseconds;

import androidx.appcompat.app.AppCompatActivity;

import android.os.AsyncTask;
import android.os.Bundle;
import android.widget.ProgressBar;

import org.jsoup.Jsoup;
import org.jsoup.select.Elements;
import org.jsoup.nodes.*;

import java.io.IOException;
import java.util.ArrayList;

public class WebScraper extends AppCompatActivity {
    private String URL = "https://www.google.com/search";
    protected String barcode;
    public static ArrayList<String> stuff;

    public WebScraper(String barcode){
        this.barcode = barcode;

    }

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_web_scraper);
    }


    private class Scrape extends AsyncTask<Void, Void, Void>{


        @Override
        protected void onPreExecute(){
            super.onPreExecute();
            ProgressBar progressBar = new ProgressBar(WebScraper.this);
            progressBar.isShown();
        }

        @Override
        protected Void doInBackground(Void... voids){
            try{
                String searchURL = URL + "?q=" + barcode + "&num=5";
                //Connect to Google Search Engine
                Document document = Jsoup.connect(searchURL)
                        .userAgent("Mozilla/5.0 Chrome/W.X.Y.Z (compatible; Googlebot/2.1; " +
                                "+http://www.google.com/bot.html)").timeout(5000).get();

                //Find barcode on Google and scrapes first five links
                Elements str = document.select("a[href]");

                /* Cycles through Elements collection generated by first scrape and gets
                   link of first search result, then immediately breaks.
                 */
                String siteLink = null;
                for(Element link: str){
                    siteLink = link.attr("href");
                    break;
                }

                /*Connects to the first search result and gets product name from title of the
                  first website
                 */
                Document document1 = Jsoup.connect(siteLink).get();
                String productName = document1.title();
                stuff.add(productName);

            } catch(IOException e){
                e.printStackTrace();
            }
            return null;
        }

        @Override
        protected void onPostExecute(Void aVoid){
            super.onPostExecute(aVoid);
        }

    }
}